---
import { Image } from "astro:assets";

const { picture, alt } = Astro.props;
---

<Image
  alt={alt}
  loading={"lazy"}
  src={`${picture.filename}/m/480x0`}
  data-large-image={`${picture.filename}/m/1920x0`}
  width={480}
  height={320}
  class="clickable-picture cursor-pointer hover:brightness-110"
/>
<script>
  const modal = document.getElementById("modal");
  const pictureContainer = document.createElement("img");
  modal?.appendChild(pictureContainer);
  pictureContainer.classList.add(
    "scale-0",
    "transition-all",
    "duration-300",
    "max-w-6xl",
    "p-24"
  );
  const showModal = (image) => {
    console.log(image);
    pictureContainer.src = image.dataset.largeImage;
    modal?.classList.remove("hidden");
    console.log("pictureContainer", pictureContainer);
    setTimeout(() => pictureContainer?.classList.add("scale-100"), 1);
  };
  const hideModal = () => {
    modal?.classList.add("hidden");
    pictureContainer?.classList.remove("scale-100");
    setTimeout(() => (pictureContainer.src = ""), 500);
  };

  modal?.addEventListener("click", hideModal);
  const images = document.getElementsByClassName("clickable-picture");
  console.log("images", images);
  for (let i = 0; i < images.length; i++) {
    const image = images[i];
    image.addEventListener("click", (e) => showModal(image));
    image.addEventListener("mouseover", (e) => fetch(image.dataset.largeImage));
  }
</script>
